<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Vidiofy - Baixador de Vídeos de Todas as Plataformas</title>
    <meta name="description" content="Baixe vídeos do YouTube, TikTok, Kwai, Instagram e mais com o Vidiofy. O seu baixador de vídeos online, rápido, gratuito e fácil de usar. Cole o link e baixe agora!">
    <meta name="keywords" content="baixar vídeo, video downloader, baixar vídeo youtube, baixar vídeo tiktok, baixar vídeo kwai, vidiofy, baixar reels, baixar stories">
    <meta name="author" content="Vidiofy">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>Vidiofy</h1>
            <nav><i class="fa-solid fa-circle-half-stroke"></i></nav>
        </div>
    </header>
    <main>
        <section class="hero">
            <div class="container">
                <h2>Baixe Vídeos de Todas as Plataformas</h2>
                <p>O melhor baixador de vídeos online e gratuito</p>
            </div>
        </section>
        <section class="download-form-section">
            <div class="container">
                <form id="url-form">
                    <div class="input-wrapper">
                        <i class="fa-solid fa-link"></i>
                        <input type="url" id="video-url" placeholder="Cole o link do vídeo aqui..." required>
                    </div>
                    <button type="submit">
                        <span class="button-text">Baixar</span>
                        <span class="button-loader" style="display: none;"><i class="fa-solid fa-spinner fa-spin"></i></span>
                    </button>
                </form>
            </div>
        </section>
        <section class="results-section">
            <div class="container" id="download-results"></div>
        </section>

        <div class="ad-container">
            <div class="ad-wrapper">
                <script type="text/javascript">
                    atOptions = {
                        'key' : 'b7ec286d7fee33fe9d365530f97986ef',
                        'format' : 'iframe',
                        'height' : 250,
                        'width' : 300,
                        'params' : {}
                    };
                </script>
                <script type="text/javascript" src="//victimfatalsentiments.com/b7ec286d7fee33fe9d365530f97986ef/invoke.js"></script>
            </div>
            
            <div class="ad-wrapper">
                <a href="https://amzn.to/4nmrlKv" target="_blank" rel="sponsored" class="amazon-banner">
                    <div class="amazon-banner-image">
                        <img src="https://m.media-amazon.com/images/I/51VxwPPv38L._AC_SX679_.jpg" alt="Notebook ASUS VivoBook na Amazon">
                    </div>
                    <div class="amazon-banner-details">
                        <p class="amazon-product-title">Notebook ASUS VivoBook Go 15, AMD RYZEN 5 7520U...</p>
                        <span class="amazon-buy-button">Ver Oferta na Amazon</span>
                    </div>
                </a>
            </div>
        </div>
        <section class="tools-section">
            <div class="container">
                <h3>Ferramentas de Download</h3>
                <div class="tools-grid">
                    <div class="tool-card"><i class="fa-brands fa-tiktok"></i><p>Baixador de TikTok</p></div>
                    <div class="tool-card"><i class="fa-brands fa-instagram"></i><p>Download de Reels e Stories</p></div>
                    <div class="tool-card"><i class="fa-brands fa-facebook"></i><p>Salvar vídeos do Facebook</p></div>
                    <div class="tool-card"><i class="fa-solid fa-k"></i><p>Baixar vídeos do Kwai</p></div>
                    <div class="tool-card"><i class="fa-brands fa-twitter"></i><p>Converter vídeos do Twitter</p></div>
                    <div class="tool-card"><i class="fa-brands fa-pinterest"></i><p>Baixar do Pinterest</p></div>
                    <div class="tool-card"><i class="fa-brands fa-youtube"></i><p>Baixar do YouTube</p></div>
                    <div class="tool-card"><i class="fa-brands fa-soundcloud"></i><p>SoundCloud para MP3</p></div>
                </div>
            </div>
        </section>

    </main>
    <footer>
        <div class="container">
            <p>&copy; 2025 Vidiofy. Todos os direitos reservados.</p>
            <div class="footer-links">
                <a href="#">Política de Privacidade</a>
                <a href="#">Termos de Serviço</a>
            </div>
        </div>
    </footer>

    <script>
        const form = document.getElementById('url-form');
        const urlInput = document.getElementById('video-url');
        const submitButton = form.querySelector('button');
        const buttonText = submitButton.querySelector('.button-text');
        const buttonLoader = submitButton.querySelector('.button-loader');
        const resultsDiv = document.getElementById('download-results');
        let pollingInterval = null;

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const videoUrl = urlInput.value;
            
            buttonText.style.display = 'none';
            buttonLoader.style.display = 'inline';
            submitButton.disabled = true;
            resultsDiv.innerHTML = `
                <div class="download-card status-card">
                    <i class="fa-solid fa-spinner fa-spin status-icon"></i>
                    <p class="status-message">Analisando o link...</p>
                </div>`;

            if (pollingInterval) clearInterval(pollingInterval);

            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: videoUrl }),
                });
                const result = await response.json();
                if (response.ok) {
                    pollingInterval = setInterval(() => checkStatus(videoUrl), 2000);
                } else {
                    handleFailure(result.message || 'Erro ao iniciar o processo.');
                }
            } catch (error) {
                handleFailure('Erro de rede. O servidor está offline?');
            }
        });

        async function checkStatus(videoUrl) {
            try {
                const response = await fetch('/api/check_status', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: videoUrl }),
                });
                const result = await response.json();

                if (result.status === 'completed') {
                    clearInterval(pollingInterval);
                    const fileSizeMB = (result.file_size / (1024 * 1024)).toFixed(2);
                    resultsDiv.innerHTML = `
                        <div class="download-card completed-card">
                            <img src="${result.thumbnail}" alt="Thumbnail" class="video-thumbnail">
                            <div class="video-details">
                                <h4>${result.title}</h4>
                                <p class="file-info">Tamanho: ${fileSizeMB} MB</p>
                                <div class="button-group">
                                    <a href="${result.download_link}" class="download-button" download="${result.file_name}">
                                        <i class="fa-solid fa-download"></i> Baixar MP4
                                    </a>
                                    <button class="copy-button" onclick="copyToClipboard('${window.location.origin}${result.download_link}')">
                                        <i class="fa-solid fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                    resetForm();
                } else if (result.status === 'failed') {
                    handleFailure(result.message);
                } else {
                    resultsDiv.innerHTML = `
                        <div class="download-card status-card">
                            <i class="fa-solid fa-spinner fa-spin status-icon"></i>
                            <p class="status-message">${result.message}</p>
                        </div>`;
                }
            } catch (error) {
                handleFailure('Erro ao verificar o status.');
            }
        }

        function handleFailure(message) {
            clearInterval(pollingInterval);
            resultsDiv.innerHTML = `<div class="download-card error-card"><p class="error-message">Falha: ${message}</p></div>`;
            resetForm(false);
        }

        function resetForm(clearInput = true) {
            if (clearInput) urlInput.value = '';
            buttonText.style.display = 'inline';
            buttonLoader.style.display = 'none';
            submitButton.disabled = false;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Link de download copiado para a área de transferência!');
            }).catch(err => {
                alert('Não foi possível copiar o link.');
            });
        }
    </script>
</body>
</html>
